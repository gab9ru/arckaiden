name: Discord Webhook

on:
  push:
    branches:
      - main   # change if your repo‚Äôs default branch is different

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send commit log to Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          # Build commit log
          commits=$(jq -r '.commits[] | "- **\(.author.name)**: \(.message) (<\(.url)>)"' $GITHUB_EVENT_PATH)

          # Add reminder at the bottom
          message="üì¢ **New push to $GITHUB_REPOSITORY** by *${{ github.actor }}*\n\n$commits\n\n‚ö†Ô∏è Don't forget to \`git fetch origin\`"

          # Prepare payload
          payload=$(jq -n --arg content "$message" '{content: $content}')

          echo "Payload to send:"
          echo "$payload"

          # Send to Discord
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$payload" \
               "$DISCORD_WEBHOOK"
